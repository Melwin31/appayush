<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Select Language — AyurSutra</title>
<style>
  :root{
    --bg-top:#eefbf6; --bg-bot:#f3fbf9;
    --phone-w:360px; --phone-h:760px;
    --card:#fff; --muted:#7c9087;
    --accent:#08b77f; --glass:rgba(255,255,255,0.92);
    --radius:14px; --soft-shadow:0 30px 60px rgba(8,24,20,0.10);
    --inner-shadow: 0 8px 26px rgba(10,20,16,0.04);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }

  /* Page / phone frame */
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-top),var(--bg-bot));display:flex;align-items:center;justify-content:center;padding:20px;box-sizing:border-box}
  .stage{width:100%;max-width:420px;display:flex;justify-content:center}
  .phone{width:var(--phone-w);height:var(--phone-h);border-radius:34px;background:linear-gradient(180deg,#f7faf8,#fbfffd);box-shadow:var(--soft-shadow);border:1px solid rgba(0,0,0,0.03);overflow:hidden;display:flex;flex-direction:column}

  /* scrollable screen */
  .screen{padding:18px;flex:1;overflow:auto;-webkit-overflow-scrolling:touch;display:flex;flex-direction:column;gap:12px;background: linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.6));}
  .screen::-webkit-scrollbar{width:8px}
  .screen::-webkit-scrollbar-thumb{background:linear-gradient(180deg,rgba(0,0,0,0.12),rgba(0,0,0,0.06));border-radius:999px;border:2px solid rgba(255,255,255,0.85)}
  .screen::-webkit-scrollbar-track{background:transparent}

  /* header */
  .header{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .back{width:40px;height:40;border-radius:10px;background:var(--glass);display:flex;align-items:center;justify-content:center;box-shadow:var(--inner-shadow);border:1px solid rgba(0,0,0,0.03);cursor:pointer}
  .title{font-weight:900;font-size:20px;color:#07221a}
  .subtitle{font-size:13px;color:var(--muted);margin-top:2px}

  /* card */
  .card{background:var(--card);border-radius:14px;padding:14px;box-shadow:var(--inner-shadow);border:1px solid rgba(0,0,0,0.03)}
  .intro{font-weight:800;font-size:16px;margin-bottom:6px}
  .intro-sub{color:var(--muted);font-size:13px}

  /* language grid */
  .lang-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:10px}
  .lang-item{
    background:linear-gradient(180deg,#fff,#fbfffb);
    border-radius:12px;padding:12px;display:flex;align-items:center;gap:12px;cursor:pointer;
    border:1px solid rgba(0,0,0,0.03);box-shadow:0 8px 26px rgba(10,20,16,0.03);transition:transform .12s ease, box-shadow .12s ease;
    text-align:left;
  }
  .lang-item:focus { outline:3px solid rgba(8,183,127,0.14); }
  .lang-item:hover{transform:translateY(-3px);box-shadow:0 12px 36px rgba(10,20,16,0.06)}
  .lang-item.active{background:linear-gradient(90deg,rgba(8,183,127,0.12),rgba(8,183,127,0.06));border:1px solid rgba(8,183,127,0.12)}
  .flag{width:56px;height:56;border-radius:10px;background:#f1fbf6;display:flex;align-items:center;justify-content:center;font-weight:900;color:var(--accent);flex-shrink:0}
  .lang-name{font-weight:900;color:#07221a}
  .lang-sub{font-size:12px;color:var(--muted);margin-top:4px}

  /* search and filter row */
  .search-row{display:flex;gap:10px;align-items:center}
  .search{
    display:flex;align-items:center;gap:10px;padding:10px;border-radius:12px;background:var(--card);box-shadow:var(--inner-shadow);border:1px solid rgba(0,0,0,0.03);flex:1
  }
  .search input{border:0;outline:none;background:transparent;font-size:14px;color:#07221a;flex:1}
  .filter-btn{width:44px;height:44;border-radius:10px;background:var(--glass);display:inline-flex;align-items:center;justify-content:center;box-shadow:var(--inner-shadow);border:1px solid rgba(0,0,0,0.03);cursor:pointer}

  /* region buttons */
  .reg-row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
  .reg-btn{padding:8px 12px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);background:transparent;cursor:pointer;font-weight:800;color:var(--muted)}
  .reg-btn.active{background:linear-gradient(90deg, rgba(8,183,127,0.12), rgba(8,183,127,0.06));color:#07221a;box-shadow:0 8px 20px rgba(8,183,127,0.06)}

  /* actions */
  .actions{display:flex;gap:12px;margin-top:12px}
  .btn{flex:1;padding:12px;border-radius:12px;border:0;font-weight:900;cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,var(--accent),#06c78b);color:#fff;box-shadow:0 10px 28px rgba(8,183,127,0.08)}
  .btn.ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);color:#07221a}

  .skip{font-size:13px;color:var(--muted);text-align:center;margin-top:8px;cursor:pointer}

  /* small toast */
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:34px;background:#07221a;color:#fff;padding:8px 12px;border-radius:999px;font-weight:700;opacity:0;pointer-events:none;transition:opacity .28s,transform .28s}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px);pointer-events:auto}

  @media (max-width:360px){ .lang-grid{grid-template-columns:repeat(2,1fr)} }
</style>
</head>
<body>
  <div class="stage">
    <div class="phone" role="application" aria-label="Language selection">
      <div class="screen">

        <!-- header -->
        <div class="header" role="banner">
          <div style="display:flex;flex-direction:column">
            <div class="title">Choose language</div>
            <div class="subtitle">Select the language you'd like to use</div>
          </div>
          <div class="back" onclick="goBack()" title="Back" aria-label="Back">←</div>
        </div>

        <!-- search / filters -->
        <div class="card" aria-hidden>
          <div class="search-row" role="search">
            <div class="search" aria-label="Search languages">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="opacity:.8"><path d="M21 21l-4.35-4.35" stroke="#6f8a81" stroke-width="1.4" stroke-linecap="round"/><circle cx="11" cy="11" r="6" stroke="#6f8a81" stroke-width="1.4"/></svg>
              <input id="searchInput" placeholder="Search language (e.g. Hindi, English)..." aria-label="Search language"/>
            </div>
            <button class="filter-btn" id="filterBtn" title="Filter" aria-label="Filter">⚙️</button>
          </div>

          <div class="reg-row" role="toolbar" aria-label="Region filters">
            <button class="reg-btn" data-region="all" onclick="applyRegion(this)">All</button>
            <button class="reg-btn" data-region="asia" onclick="applyRegion(this)">Asia</button>
            <button class="reg-btn" data-region="europe" onclick="applyRegion(this)">Europe</button>
            <button class="reg-btn" data-region="other" onclick="applyRegion(this)">Other</button>
          </div>
        </div>

        <!-- languages -->
        <div class="card" style="padding:12px 10px 6px">
          <div class="intro">Available languages</div>
          <div class="intro-sub">Tap one to select it — we'll remember your choice</div>

          <div class="lang-grid" id="langGrid" role="list" aria-label="Languages list">
            <!-- populated by JS -->
          </div>

          <div class="actions">
            <button class="btn ghost" onclick="skipLanguage()">Skip</button>
            <button class="btn primary" id="continueBtn" onclick="confirmLanguage()" disabled>Continue</button>
          </div>

          <div class="skip" onclick="skipLanguage()">Prefer English — Continue in English</div>
        </div>

      </div> <!-- screen -->
    </div> <!-- phone -->
  </div> <!-- stage -->

  <div id="toast" class="toast" role="status" aria-live="polite">Language saved — redirecting…</div>

<script>
  // language set (same as before)
  const languages = [
    { code:'en', name:'English', native:'English', flag:'🇬🇧', region:'europe' },
    { code:'hi', name:'Hindi', native:'हिन्दी', flag:'🇮🇳', region:'asia' },
    { code:'mr', name:'Marathi', native:'मराठी', flag:'🇮🇳', region:'asia' },
    { code:'bn', name:'Bengali', native:'বাংলা', flag:'🇧🇩', region:'asia' },
    { code:'ta', name:'Tamil', native:'தமிழ்', flag:'🇮🇳', region:'asia' },
    { code:'te', name:'Telugu', native:'తెలుగు', flag:'🇮🇳', region:'asia' },
    { code:'gu', name:'Gujarati', native:'ગુજરાતી', flag:'🇮🇳', region:'asia' },
    { code:'kn', name:'Kannada', native:'ಕನ್ನಡ', flag:'🇮🇳', region:'asia' },
    { code:'ur', name:'Urdu', native:'اردو', flag:'🇵🇰', region:'asia' },
    { code:'ar', name:'Arabic', native:'العربية', flag:'🇸🇦', region:'other' },
    { code:'fr', name:'French', native:'Français', flag:'🇫🇷', region:'europe' },
    { code:'es', name:'Spanish', native:'Español', flag:'🇪🇸', region:'europe' }
  ];

  const langGrid = document.getElementById('langGrid');
  const continueBtn = document.getElementById('continueBtn');
  let selected = null;

  function createCard(lang){
    const item = document.createElement('button');
    item.className = 'lang-item';
    item.type = 'button';
    item.setAttribute('data-code', lang.code);
    item.setAttribute('data-region', lang.region);
    item.setAttribute('role','listitem');
    item.innerHTML = `
      <div class="flag" aria-hidden>${lang.flag}</div>
      <div style="min-width:0">
        <div class="lang-name">${lang.name}</div>
        <div class="lang-sub">${lang.native}</div>
      </div>
    `;
    item.addEventListener('click', ()=> {
      document.querySelectorAll('.lang-item').forEach(el => el.classList.remove('active'));
      item.classList.add('active');
      selected = lang;
      continueBtn.disabled = false;
    });
    // keyboard accessibility
    item.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); item.click(); }
    });
    return item;
  }

  function renderGrid(list){
    langGrid.innerHTML = '';
    list.forEach(lang => langGrid.appendChild(createCard(lang)));
    // preselect saved choice if present
    try {
      const saved = JSON.parse(localStorage.getItem('ayur_lang') || 'null');
      if(saved && saved.code){
        const el = document.querySelector(`.lang-item[data-code="${saved.code}"]`);
        if(el){ el.classList.add('active'); selected = saved; continueBtn.disabled = false; }
      }
    } catch(e){}
  }

  renderGrid(languages);

  // search
  document.getElementById('searchInput').addEventListener('input', (e)=>{
    const q = e.target.value.trim().toLowerCase();
    const filtered = languages.filter(l => l.name.toLowerCase().includes(q) || (l.native && l.native.toLowerCase().includes(q)));
    renderGrid(filtered);
  });

  // region filters
  function applyRegion(btn){
    document.querySelectorAll('.reg-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const region = btn.dataset.region;
    if(region === 'all') { renderGrid(languages); return; }
    renderGrid(languages.filter(l => l.region === region));
  }

  // Save + redirect helper
  function saveAndRedirect(langObj){
    const payload = { code: langObj.code, name: langObj.name, savedAt: Date.now() };
    try { localStorage.setItem('ayur_lang', JSON.stringify(payload)); } catch(e){ console.warn(e); }
    showToast('Language saved — redirecting…');
    // redirect after a short pause so toast is visible (250ms)
    setTimeout(()=> {
      // include query param so home.html can read quickly if desired
      window.location.href = 'home.html' + '?lang=' + encodeURIComponent(langObj.code);
    }, 250);
  }

  function confirmLanguage(){
    if(!selected) return;
    saveAndRedirect(selected);
  }

  function skipLanguage(){
    const fallback = { code:'en', name:'English' };
    saveAndRedirect(fallback);
  }

  function goBack(){
    if(document.referrer) history.back(); else location.href='login.html';
  }

  // small toast
  const toast = document.getElementById('toast');
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(()=> toast.classList.remove('show'), 1800);
  }

  // keyboard nav support (arrows)
  document.addEventListener('keydown', (e)=>{
    const keys = ['ArrowRight','ArrowLeft','ArrowUp','ArrowDown'];
    if(!keys.includes(e.key)) return;
    const items = Array.from(document.querySelectorAll('.lang-item'));
    if(!items.length) return;
    const currentIdx = items.findIndex(i => i.classList.contains('active'));
    let next = 0;
    if(currentIdx === -1) next = 0;
    else {
      if(e.key === 'ArrowRight' || e.key === 'ArrowDown') next = Math.min(items.length - 1, currentIdx + 1);
      if(e.key === 'ArrowLeft' || e.key === 'ArrowUp') next = Math.max(0, currentIdx - 1);
    }
    items[next].focus();
    items[next].click();
  });
</script>
</body>
</html>
